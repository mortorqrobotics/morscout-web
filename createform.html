<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MorScout</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Exo+2:100' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link rel="stylesheet" href="css/form.css" type="text/css">
    <link rel="stylesheet" href="css/login.css" type="text/css">
    <link rel="stylesheet" href="css/feedback.css" type="text/css">
    <link rel="stylesheet" href="css/welcome_page.css" type="text/css">
    <link rel="stylesheet" href="css/report_screen.css" type="text/css">
    <link rel="stylesheet" href="css/sync.css" type="text/css">
</head>

<body>

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" id="morscout" href="index.html">MorScout</a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#MorScoutNav" id="toggle-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="MorScoutNav">
                <ul class="nav navbar-nav">
                    <li><a href="matches.html" title="List of all matches">All Matches</a></li>
                    <li><a href="teams.html" title="List of all teams">Team List</a></li>
                    <li><a href="sync.html" title="Sync with the server">Sync</a></li>
                    <li><a href="settings.html" title="Configure the settings">Settings</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="help.html" title="Need help?">Help</a></li>
                    <li><a href="feedback.html" title="Give team 1515 your feedback!">Feedback</a></li>
                    <li id="UserDropdown" class="dropdown">
                        <a id="logoutButton" href="login.html">Log in</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="formbutton">
        <input type="button" class="formmakerbutton" id="formbutton" value="Add Data Point">
    </div>

    <div class="submitbutton">
        <input type="button" id="submitformbutton" value="Preview Form">
    </div>

    <div class="formcreator">
        <div class="container">
            <div class="row" id="form-holder">
                <h2>Create Scouting Form</h2>

                <form class="form-type">
                    <input class="report-check" type="radio" name="ft" id="match-form" value="match">
                    <label id="report-text" for="match-form" class="report-radio-check">Match Form</label><br/>
                    <input class="report-check" type="radio" name="ft" id="pit-form" value="pit">
                    <label id="report-text" for="pit-form" class="report-radio-check">Pit Form</label><br/>
                </form>
                <br>
                <!-- <select required class='creator_dropdown'>
           <option value='text'>Text Box</option>
           <option value='dropdown'>Dropdown List</option>
           <option value='radio'>Radio Button</option>
           <option value='label'>Label</option>
           <option value='number'>Number Box</option>
           <option value='check'>Check Box</option>
         </select>
         <input type="text" class="dp-box" id="data_point_name" placeholder="Data Point Name" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Data Point Name'"><br>
         <div id="form_options">
      </div> -->
                <!--  <br>
      <select required class='creator_dropdown'>
        <option value='text'>Text Box</option>
        <option value='dropdown'>Dropdown List</option>
        <option value='radio'>Radio Button</option>
        <option value='label'>Label</option>
        <option value='number'>Number Box</option>
        <option value='check'>Check Box</option>
      </select>
      <input type="text" class="dp-box" id="data_point_name" placeholder="Data Point Name" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Data Point Name'"><br>
      <div id="form_options">
   </div> -->



            </div>
            <h2>Form Preview</h2>
            <div class="row" id="form-preview">

            </div>
            <div class="sendbutton">
                <input type="button" id="sendformbutton" value="Send Form" hidden>
            </div>



            <!-- <div id="submit-form">
             <input type="button" id="submit-form-button" value="Submit Form">
     </div> -->

            <!-- JAVASCRIPT -->
            <script src="js/jquery-2.1.3.min.js"></script>
            <script src="js/bootstrap.min.js"></script>
            <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.1/isotope.pkgd.min.js"></script> -->
            <script src="js/main.js" type="text/javascript"></script>

            <script>
                function createNewDataPoint() {
                    var divWrapper = $(document.createElement("div"));
                    divWrapper.addClass("dp-wrapper");
                    var wrappers = $("#form-holder").find(".dp-wrapper");
                    var dpNum = "1";
                    if (wrappers.length != 0) {
                        dpNum = parseInt($(wrappers[wrappers.length - 1]).attr("data-id")) + 1 + "";
                    }
                    divWrapper.attr("data-id", dpNum);
                    var select = $(document.createElement("select"));
                    select.addClass("creator-dropdown");
                    select.attr("required", "true");
                    var options = [{
                        value: "text",
                        name: "Text Box"
                    }, {
                        value: "dropdown",
                        name: "Dropdown List"
                    }, {
                        value: "radio",
                        name: "Radio Button"
                    }, {
                        value: "label",
                        name: "Label"
                    }, {
                        value: "number",
                        name: "Number Box"
                    }, {
                        value: "check",
                        name: "Check Box"
                    }];
                    for (var i = 0; i < options.length; i++) {
                        var option = $(document.createElement("option"));
                        option.attr("value", options[i].value);
                        option.html(options[i].name);
                        select.append(option);
                    }
                    var input = $(document.createElement("input"));
                    input.attr("type", "text");
                    input.addClass("dp-box data-point-name");
                    input.attr("placeholder", "Data Point Name");
                    var span = $(document.createElement("span"));
                    span.addClass("glyphicon glyphicon-remove remove-dp btn-lg");
                    var div = $(document.createElement("div"));
                    div.addClass("form-options");
                    span.attr("data-id", dpNum);
                    select.attr("data-id", dpNum);
                    input.attr("data-id", dpNum);
                    div.attr("data-id", dpNum);
                    divWrapper.append(select);
                    divWrapper.append(input);
                    divWrapper.append(span);
                    divWrapper.append(div);
                    $("#form-holder").append(divWrapper);
                }
                createNewDataPoint();

                $("#formbutton").on("click", function() {
                    createNewDataPoint();
                });

                $("#sendformbutton").on("click", function(){
                    var formType = $('input:radio[name=ft]:checked').val();
                    //var allDataPoints = JSON.parse(localStorage.allDataPoints);
                    console.log(JSON.stringify(allDataPoints));
                    if (allDataPoints && allDataPoints.length != 0 && formType){
                        $.post("/setScoutForm", {"dataPoints": allDataPoints, "context": formType}, function(response){
                            if (response == "success") {
                                localStorage.removeItem("allDataPoints");
                                alert("Success");
                            }
                            else {
                                alert("Failed to send form");
                            }
                        });
                    }
                    else {
                        alert("Field missing or invalid input");
                    }
                });

                function synthesizeForm(dataPoints) {
                    $('#form-preview').empty();
                    var form = $('#form-preview');
                    var oneColumn = true;
                    for (var i = 0; i < dataPoints.length; i++) {
                        var dataPoint = dataPoints[i];
                        var dpName = dataPoint.name;
                        var dpType = dataPoint.type;
                        if (dpType == "radio") {
                            var options = dataPoint.options;
                            var div = $(document.createElement("div"));
                            div.addClass("radio");
                            // if (oneColumn == true) {
                            //   div.addClass('col-md-12');
                            //   oneColumn = false;
                            // }
                            // else {
                            //   div.addClass('col-md-6');
                            // }
                            for (var j = 0; j < options.length; j++) {
                                var option = options[j];
                                var input = $(document.createElement("input"));
                                input.attr("type", "radio");
                                input.attr("name", dpName);
                                input.attr("id", option);
                                input.addClass("report-check");
                                var label = $(document.createElement("label"));
                                label.addClass("report-text report-radio-check");
                                label.attr("for", option);
                                label.html(option);
                                div.append(input);
                                div.append(label);
                                div.append("<br/>");
                            }
                            var p = $(document.createElement("p"));
                            p.addClass("report-text");
                            p.html(dpName);
                            form.append(div);

                        } else if (dpType == "dropdown") {
                            var div = $(document.createElement('div'));
                            // if (oneColumn == true) {
                            //   div.addClass('col-md-12');
                            //   oneColumn = false;
                            // }
                            // else {
                            //   div.addClass('col-md-6');
                            // }
                            var options = dataPoint.options;
                            var select = $(document.createElement("select"));
                            select.addClass("creator-dropdown");
                            for (var j = 0; j < options.length; j++) {
                                var optionText = options[j];
                                var option = $(document.createElement("option"));
                                option.html(optionText);
                                select.append(option);
                            }
                            var p = $(document.createElement("p"));
                            p.addClass("report-text");
                            p.html(dpName + ": ");

                            div.append(p);
                            div.append(select);
                            form.append(div)
                        } else if (dpType == "number") {
                            var div = $(document.createElement('div'));
                            // if (oneColumn == true) {
                            //   div.addClass('col-md-12');
                            //   oneColumn = false;
                            // }
                            // else {
                            //   div.addClass('col-md-6');
                            // }
                            var start = dataPoint.start;
                            var min = dataPoint.min;
                            var max = dataPoint.max;

                            var p = $(document.createElement("p"));
                            p.addClass("report-text");
                            p.html(dpName + ": ");

                            var inputBox = $(document.createElement("input"));
                            inputBox.attr("type", "number");
                            inputBox.addClass("report-box-small");
                            inputBox.attr("id", dpName);
                            inputBox.attr("min", min);
                            inputBox.attr("max", max);
                            inputBox.val(start);
                            inputBox.keyup(function(){
                                if (parseInt(inputBox.val()) < min || inputBox.val().indexOf(".") > -1){
                                    inputBox.val(min);
                                }
                                else if (parseInt(inputBox.val()) > max){
                                    inputBox.val(max);
                                }
                            });

                            var inputSubtract = $(document.createElement("input"));
                            inputSubtract.attr("type", "button");
                            inputSubtract.addClass("button add-minus-button");
                            inputSubtract.attr("id", dpName);
                            inputSubtract.val("-");
                            inputSubtract.click(function(){
                                if (parseInt(inputBox.val()) > min){
                                    inputBox.val(parseInt(inputBox.val()) - 1);
                                }
                            });

                            var inputAdd = $(document.createElement("input"));
                            inputAdd.attr("type", "button");
                            inputAdd.attr("id", dpName);
                            inputAdd.addClass("button add-minus-button");
                            inputAdd.val("+");
                            inputAdd.click(function(){
                                if (parseInt(inputBox.val()) < max){
                                    inputBox.val(parseInt(inputBox.val()) + 1);
                                }
                            });

                            div.append(p);
                            div.append(inputSubtract);
                            div.append(inputBox);
                            div.append(inputAdd);
                            form.append(div);
                        } else if (dpType == "check") {
                            var div = $(document.createElement('div'));
                            if (oneColumn == true) {
                              div.addClass('col-md-12');
                              oneColumn = false;
                            }
                            else {
                              div.addClass('col-md-6');
                            }
                            var input = $(document.createElement("input"));
                            input.attr("type", "checkbox");
                            input.addClass("report-check");
                            input.attr("id", dpName);
                            var label = $(document.createElement("label"));
                            label.attr("for", dpName);
                            label.addClass("report-radio-check report-text");
                            label.html(dpName);
                            div.append(input);
                            div.append(label);
                            form.append(div);
                        } else if (dpType == "label") {
                            var div = $(document.createElement('div'));
                            // if (oneColumn == true) {
                            //   div.addClass('col-md-12');
                            //   oneColumn = false;
                            // }
                            // else {
                            //   div.addClass('col-md-6');
                            // }
                            var h3 = $(document.createElement("h3"));
                            h3.addClass("scout-div-title");
                            h3.html(dpName);
                            div.append(h3);
                            form.append(div);
                        } else if (dpType == "text") {
                            var div = $(document.createElement('div'));
                            // if (oneColumn == true) {
                            //   div.addClass('col-md-12');
                            //   oneColumn = false;
                            // }
                            // else {
                            //   div.addClass('col-md-6');
                            // }
                            var textarea = $(document.createElement("textarea"));
                            textarea.addClass("report-area");
                            textarea.attr("placeholder", dpName);
                            div.append(textarea);
                            form.append(div);
                        }
                        $('#form-preview').append("</br></br>");
                    }
                }

                function createDropdownInput(textboxHolder) {
                    var input = $(document.createElement("input"));
                    input.attr("type", "text");
                    input.attr("placeholder", "Option");
                    input.addClass("option-box");
                    textboxHolder.append(input);
                    var added = false;
                    input.keyup(function() {
                        if ($.trim(input.val()) != "") {
                            if (!added) {
                                createDropdownInput(textboxHolder);
                                added = true;
                            }
                        } else if (added) {
                            input.remove();
                        }
                    });
                }

                $(document).on("click", ".remove-dp", function() {
                    var id = $(this).attr("data-id");
                    $(".dp-wrapper[data-id='" + id + "']").hide('slow', function() {
                        $(".dp-wrapper[data-id='" + id + "']").remove();
                    });
                });

                $("#submitformbutton").on("click", function() {
                    var wrappers = $("#form-holder").find(".dp-wrapper");
                    var dataPoints = [];
                    var pointsValid = true;
                    if (wrappers.length == 0) pointsValid = false;
                    for (var i = 0; i < wrappers.length; i++) {
                        var dp = $(wrappers[i]);
                        var dataPointInfo = {};
                        var dpType = dp.find(".creator-dropdown").eq(0).val();
                        var dpName = dp.find(".data-point-name").eq(0).val();
                        if ($.trim(dpName) != "" && $.trim(dpType) != "") {
                            dataPointInfo.name = dpName;
                            dataPointInfo.type = dpType;
                            if (dpType == "radio" || dpType == "dropdown") {
                                var options = [];
                                var optionBoxes = dp.find(".option-box");
                                for (var j = 0; j < optionBoxes.length; j++) {
                                    var box = $(optionBoxes[j]);
                                    if ($.trim(box.val()) != "") {
                                        options.push(box.val());
                                    }
                                }
                                dataPointInfo.options = options;
                            } else if (dpType == "number") {
                                var start = dp.find(".start-box").eq(0).val();
                                var min = dp.find(".min-box").eq(0).val();
                                var max = dp.find(".max-box").eq(0).val();
                                if (areNumbers([start, min, max]) && (parseInt(min) <= parseInt(max)) && (parseInt(start) >= parseInt(min))) {
                                    dataPointInfo.start = parseInt(start);
                                    dataPointInfo.min = parseInt(min);
                                    dataPointInfo.max = parseInt(max);
                                } else {
                                    pointsValid = false;
                                    break;
                                }
                            } else {
                                //use later?
                            }
                            dataPoints.push(dataPointInfo);
                        } else {
                            pointsValid = false;
                            break;
                        }
                    }
                    if (pointsValid && ($('input:radio[name=ft]:checked').val() == "match" || $('input:radio[name=ft]:checked').val() == "pit")) {
                        //alert("Success");
                        $("#sendformbutton").show();
                        allDataPoints = dataPoints;
                        localStorage.allDataPoints = JSON.stringify(dataPoints);
                        synthesizeForm(dataPoints);
                        //dataPoints is an array of all information
                    } else {
                        alert("Field missing or invalid input");
                    }
                });

                $(document).on("change", ".creator-dropdown", function() {
                    var id = $(this).attr("data-id");
                    var options = $(".form-options[data-id='" + id + "']");
                    options.empty();
                    var type = $(this).val();
                    if (type == "radio" || type == "dropdown") {
                        createDropdownInput(options);
                    } else if (type == "number") {
                        var input = $(document.createElement("input"));
                        input.attr("type", "number");
                        input.attr("placeholder", "start");
                        input.addClass('start-box');
                        options.append(input);

                        var input = $(document.createElement("input"));
                        input.attr("type", "number");
                        input.attr("placeholder", "min");
                        input.addClass('min-box');
                        options.append(input);

                        var input = $(document.createElement("input"));
                        input.attr("type", "number");
                        input.attr("placeholder", "max");
                        input.addClass('max-box');
                        options.append(input);
                    } else {
                        //use later?
                    }


                });
            </script>

</body>

</html>
