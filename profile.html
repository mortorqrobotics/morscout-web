<!DOCTYPE html>
<html lang="en">

  <head>
  	<meta charset="utf-8" />
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MorScout - Profile</title>
  	<link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Exo+2:400,300,200' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <link href="../jbox/jBox.css" rel="stylesheet">
    <link href="../jbox/themes/TooltipDark.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link rel="stylesheet" href="css/profile.css" type="text/css">
    <link rel="stylesheet" href="css/login.css" type="text/css">


  </head>
  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">MorScout</a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#MorScoutNav" id="toggle-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="MorScoutNav">
                <ul class="nav navbar-nav">
                    <li><a href="matches.html" title="List of all matches">All Matches</a></li>
                    <li><a href="teams.html" title="List of all teams">Team List</a></li>
                    <li><a href="settings.html" title="Configure the settings">Settings</a></li>
                </ul>
                <div class='user-search nav navbar-nav'>
                  <input type="text" placeholder="search teammates" class="nav-tbox"></input>
                  <div class="search-drop">
                    <ul class="search-drop-items">
                    </ul>
                  </div>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <!-- <li><a href="help.html" title="Need help?">Help</a></li>
                    <li><a href="feedback.html" title="Give team 1515 your feedback!">Feedback</a></li> -->
                    <li style="background-color:orange;"><a href="profile.html"  title="User Profile">Profile</a></li>
            		    <li id="UserDropdown" class="dropdown">
                      <a id="logoutButton" href="login.html">Log in</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="left-bar">
      <h1 id="profile-name"></h1>
      <img class="profile-pic" src="http://www.allegraabbotsford.com/wp-content/uploads/2015/06/generic-profile.png"/>
      <h3 id="team-label"></h3>
      <!-- <h3>[Phone]</h3>
      <h3>[Email]</h3> -->
      <!-- <input type="button" class="button left-button" id="left-bar-button" value="Edit Profie"></input>
      <input type="button" class="button left-button" id="left-bar-button" value="Change Password"></input> -->

    </div>

    <div class="row">

      <div class="col-md-6">
        <div class="assignments">
          <h1 class="scout-div-title profile-div-title">Assignments</h1>
          <ul id="task-list">
            <!-- <li class="profile- profile-li-font">From Match 1 to 10, Red Alliance, Team 2</li> -->
          </ul>
        </div>
      </div>

      <div class="col-md-6">
        <div class="stats">
          <h1 class="scout-div-title profile-div-title">Statistics</h1>
          <ul>
            <li class="profile-li-font">Match Reports Made: <span id="matches-scouted-label"></span></li>
            <li class="profile-li-font">Pit Reports Made: <span id="pits-scouted-label"></span></li>
            <li class="profile-li-font">Unique Teams Scouted: <span id="teams-scouted-label"></span></li>
            <li class="profile-li-font">Assigned Matches Completed: <span id="complete-matches-label"></span></li>
            <li class="profile-li-font">Assigned Matches Not Completed: <span id="not-complete-matches-label"></span></li>
            <li class="profile-li-font">Assignment Completion: <span id="completion-label"></span></li>
          </div>
        </div>

    </div>

    <div class="assign-task">
      <h1 class="scout-div-title profile-div-title" id="task-assign-heading">Assign Task</h1>
      <div class="assign-task-div">
        <h3 class="page-title task-heading task-inline" id="first-word">From Match</h3>
        <input id="start-match-box" type="number" class="report-box-small inp-val-box task-tbox task-inline" min="1" placeholder="#">
        <h3 class="page-title task-heading task-inline" id="task-second-word">To</h3>
        <input id="end-match-box" type="number" class="report-box-small inp-val-box task-tbox task-inline" min="1" placeholder="#">
        <select id="alliance-drop" class="task-inline creator-dropdown task-dropdown">
          <option value="red">Red Alliance</option>
          <option value="blue">Blue Alliance</option>
        </select>
        <h3 class="page-title task-heading task-inline" id="task-second-word">Team:</h3>
        <select id="sect-drop" class="task-inline task-dropdown">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
      </div>
      <input type="button" class="button" id="assign-button" value="Assign"></input>
    </div>

    <script src="js/main.js" type="text/javascript"></script>

    <script>

    var userID = qs("id");
    if (!userID){
        userID = localStorage.userID;
    }

    if (localStorage.admin != "true"){//server is still protected
        $(".assign-task").hide();
    }

    $.post("/getUserStats", {userID: userID}, function(response){
        var stats = JSON.parse(response);
        id="matches-scouted-label"
        $("#teams-scouted-label").html(stats.teamsScouted);
        $("#matches-scouted-label").html(stats.matchesScouted);
        $("#pits-scouted-label").html(stats.pitsScouted);
        var teammates = JSON.parse(JSON.parse(localStorage.teammates));//
        var firstName =localStorage.firstName;
        var lastName = localStorage.lastName;
        var teamNumber = localStorage.teamNumber;
        if (userID != localStorage.userID){
            for (var i = 0; i < teammates.length; i++){
                if (teammates[i]._id == userID){
                    firstName = teammates[i].firstName;
                    lastName = teammates[i].lastName;
                    break;
                }
            }
        }
        $("#team-label").html("Team " + teamNumber);
        $("#profile-name").html(firstName + " " + lastName);
    });


    loadTasks();
    $("#assign-button").on("click", function(){
        $.post("/assignTask", {
            startMatch: $("#start-match-box").val(),
            endMatch: $("#end-match-box").val(),
            alliance: $("#alliance-drop").val(),
            teamSection: $("#sect-drop").val(),
            scoutID: userID
        }, function(response){
            alert(response);
            loadTasks();
        });
    });

    function loadTasks(){
        var taskList = $("#task-list");
        taskList.empty();
        $.post("/showTasks", {scoutID: userID}, function(response){
            var tasks = JSON.parse(response);
            for (var i = 0; i < tasks.assignments.length; i++){
                var task = tasks.assignments[i];
                var li = $(document.createElement("li"));
                li.addClass("profile- profile-li-font");
                li.html("From match " + task.startMatch + " to " + task.endMatch + ", " + task.alliance.substring(0, 1).toUpperCase() + task.alliance.substring(1) + " Alliance, Team " + task.teamSection)
                taskList.append(li);
            }
            $("#complete-matches-label").html(tasks.matchesDone.join(", "));
            $("#not-complete-matches-label").html(tasks.matchesNotDone.join(", "));
            $("#completion-label").html(tasks.matchesDone.length + "/" + (tasks.matchesDone.length + tasks.matchesNotDone.length));
        });
    }

    </script>





  </body>
</html>
