<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MorScout - Report Match</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Exo+2:100' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link rel="stylesheet" href="css/report_screen.css" type="text/css">
</head>

<body>

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">MorScout</a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#MorScoutNav" id="toggle-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="MorScoutNav">
                <ul class="nav navbar-nav">
                    <li><a href="matches.html" title="List of all matches">All Matches</a></li>
                    <li><a href="teams.html" title="List of all teams">Team List</a></li>
                    <li><a href="settings.html" title="Configure the settings">Settings</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <!-- <li><a href="help.html" title="Need help?">Help</a></li>
    			<li><a href="feedback.html" title="Give team 1515 your feedback!">Feedback</a></li> -->
			<li><a href="http://www.morteam.com"  title="MorTeam Link">MorTeam</a></li>
                    <li><a href="profile.html" title="User Profile">Profile</a></li>
                    <li id="UserDropdown" class="dropdown">
                        <a id="logoutButton" href="login.html">Log out</a>
                    </li>
                </ul>
                <div class='user-search nav navbar-nav'>
                    <input type="text" placeholder="search teammates" class="nav-tbox"></input>
                    <div class="search-drop">
                        <ul class="search-drop-items">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="report">
        <div class="container-fluid">
            <div id="report-title" class="page-title">
                <h2>Match </h2>
                <h2 id="report-match-num"></h2>
                <h2> - </h2>
                <h2 id="report-match-time"></h2>
                <h2 id="report-instruction">Choose a team to scout or view</h2>
            </div>
            <div class="row">
                <div class="col-md-2 col-sm-0 col-xs-0"></div>
                <div class="col-md-8 col-sm-12 col-xs-12">
                    <h3 id="strategy-heading">Strategy</h1>
            <div id="strategy-holder">
              <h3 class="orange" id="strategy-text">None</h3>
                </div>
            </div>
            <div class="col-md-2 col-sm-0 col-xs-0"></div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table class="report-table">
                    <tr>
                        <th id="rh">Red Teams</th>
                        <th id="bh">Blue Teams</th>
                    </tr>
                    <tr>
                        <td id="r1"></td>
                        <td id="b1"></td>
                    </tr>
                    <tr>
                        <td id="r2"></td>
                        <td id="b2"></td>
                    </tr>
                    <tr>
                        <td id="r3"></td>
                        <td id="b3"></td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1 col-sm-0 col-xs-0">
            </div>
            <div class="col-md-10 col-sm-12 col-xs-12">
                <ul id="report-tabs" class="nav nav-tabs" hidden>
                    <li id="scout-tab" class="active"><a href="javascript: void(0);">Scout</a></li>
                    <li id="view-tab"><a href="javascript: void(0);">View</a></li>
                    <li id="viewMatches-tab"><a href="javascript: void(0);">All Matches</a></li>
                    <li id="editStrategy-tab"><a href="javascript: void(0);">Edit Strategy</a></li>
                </ul>
            </div>
            <div class="col-md-1 col-sm-0 col-xs-0">
            </div>
        </div>
        <div id="form-preview" class="row">
            <!-- <div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    			<div class="col-md-5 col-sm-6 col-xs-12">
    	  	    	<div class="scout-div">
    	  	    		<h3 class="scout-div-title">Autonomous</h3>
    	  	    		<div class="radio">
    		  	    		<input class="report-check" type="radio" name="auto" id="nearDrivers"></input>
    		  	    		<label id="report-text" for="nearDrivers" class="report-radio-check">Started near drivers</label><br/>
    						<input class="report-check" type="radio" name="auto" id="radio12"></input>
    						<label id="report-text" for="radio12" class="report-radio-check">Started near landfill</label><br/>
    					</div>

    	  	    		<input class="report-check" type="checkbox" id="robotMoved"></input>
    	  	    		<label id="report-text" for="robotMoved" class="report-radio-check">Robot moves to auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="toteMoved"></input>
    					<label id="report-text" for="toteMoved" class="report-radio-check">Tote moved to auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="containerMoved"></input>
    					<label id="report-text" for="containerMoved" class="report-radio-check">Container set on auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="toteStacked"></input>
    					<label id="report-text" for="toteStacked" class="report-radio-check">Single stacked tote set?</label><br/>

    	  	    		<p id="report-text">Highest level tote stacked: </p>
    	  	    		<input id="report-box-small" class="highestToteAuto" type="number"></input><br/>

    	  	    		<textarea id="autoComments" class="report-area" placeholder="comments"></textarea>
    	  	    	</div>
    			</div>
    			<div class="col-md-5 col-sm-6 col-xs-12">
    				<div class="scout-div">
    				    <h3 class="scout-div-title">Teleop</h3>

    					<p id="report-text">Gray tote scored</p>
    	  	    		<input type="button" id="grayTotesMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="grayTotes" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="grayTotesPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Container scored</p>
    	  	    		<input type="button" id="containersMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="containers" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="containersPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Litter in container</p>
    	  	    		<input type="button" id="containerLitterMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="containerLitter" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="containerLitterPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Litter put in landfill</p>
    	  	    		<input type="button" id="landfillLitterMinus" class="button add-minus-button" value="-"></input
    	  	    		><input class="landfillLitter" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="landfillLitterPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Highest level tote stacked: </p>
    	  	    		<input id="report-box-small" type="number" class="highestToteTeleop"></input><br/>

    	  	    		<input class="report-check" type="checkbox" id="landfillContainer"></input>
    	  	    		<label id="report-text" for="landfillContainer" class="report-radio-check">Gets container from landfill?</label><br/>
    	  	    		<div class="radio">
    		  	    		<input class="report-check" type="radio" id="coopertitionSet" name="coopertition"></input>
    		  	    		<label id="report-text" for="coopertitionSet" class="report-radio-check">Coopertition set</label><br/>
    						<input class="report-check" type="radio" id="coopertitionStack" name="coopertition"></input>
    						<label id="report-text" for="coopertitionStack" class="report-radio-check">Coopertition stack</label><br/>
    					</div>
    					<textarea id="teleopComments" class="report-area" placeholder="comments"></textarea>
    				</div>
    			</div>
    			<div class="col-md-1 col-sm-0 col-xs-0">
    			</div> -->
        </div>
        <div class="submit-match">
            <button id="submit-match-report" class="button">Submit</button>
        </div>
        <div id="viewContainer"></div>
        <div id="viewMatches-form" class="row">
            <div class="col-md-1 col-sm-0 col-xs-0">
            </div>
            <div class="col-md-10 col-sm-12 col-xs-12">
                <h3 class="page-title">All Matches For This Team</h3>
                <table class="matches-table" id="match-table">
                    <tr id="first-matches-row"></tr>
                </table>
            </div>
        </div>
        <div class="col-md-1 col-sm-0 col-xs-0">
        </div>
    </div>
    </div>
    <div id="editStrategy-form" class="row">
        <div class="col-md-1 col-sm-0 col-xs-0"></div>
        <div class="col-md-10 col-sm-12 col-xs-12">
            <textarea id="strategy-box" placeholder="Edit Strategy"></textarea>
            <input type="button" id="update-button" class="button" value="Update"></input>
        </div>
        <div class="col-md-1 col-sm-0 col-xs-0"></div>
    </div>
    </div>

    <!-- JAVASCRIPT -->

    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="js/reportTable.js"></script>
    <script src="js/main.js" type="text/javascript"></script>

    <script>
        function smoothScroll(id) {
            var aTag = $("#" + id);
            $('html,body').animate({
                scrollTop: aTag.offset().top
            }, 300);
        }

        $(document).ready(function() {
            currentMatch = parseInt(qs("match"));

            getScoutForm("match");


            $("#strategy-holder").hide();
            $("#strategy-heading").hide();
            $('#editStrategy-tab').hide();
            $("#editStrategy-form").hide();

            $("#report-match-num").html(qs("match"));

            function getMatchInfo(cb) {
                testConnection(function(exists) {
                    if (exists) {
                        $.post("/getMatchInfo", {
                            match: qs("match")
                        }, function(response) {
                            if (response != "fail") {
                                cb(JSON.parse(response));
                            } else {
                                alert("Unable to retrieve match info");
                            }
                        });
                    } else {
                        var matches = JSON.parse(localStorage.allMatches);
                        for (var i = 0; i < matches.length; i++) {
                            if (matches[i].comp_level == "qm" && matches[i].match_number == currentMatch) {
                                cb(matches[i]);
                                break;
                            }
                        }
                    }
                });
            }

            getMatchInfo(function(match) {
                $("#report-match-time").html(standardizeTime(match.time));
                var redAlliance = match.alliances.red.teams;
                var blueAlliance = match.alliances.blue.teams;
                var ourMatch = false;
                for (var i = 0; i < 3; i++) {
                    if (redAlliance[i].substring(3) == localStorage.teamNumber || blueAlliance[i].substring(3) == localStorage.teamNumber) {
                        ourMatch = true;
                    }
                    $("#r" + (i + 1)).html(redAlliance[i].substring(3));
                    $("#b" + (i + 1)).html(blueAlliance[i].substring(3));
                }
                if (ourMatch) {
                    $("#strategy-holder").show();
                    $("#strategy-heading").show();
                    $('#editStrategy-tab').show();
                    $("#eidtStrategy-form").show();
                    loadStrategy();
                }
            });

            function loadStrategy() {
                getStrategies(function(strategies) {
                    var found = false;
                    for (var i = 0; i < strategies.length; i++) {
                        if (strategies[i].matchNumber == parseInt(qs("match"))) {
                            found = true;
                            $("#strategy-text").html(strategies[i].strategy);
                            $("#strategy-box").val(strategies[i].strategy.split("&lt;").join("<").split("&gt;").join(">"));
                        }
                    }
                    if (!found) {
                        $("#strategy-text").html("None");
                        $("#strategy-box").val("");
                    }
                });
            }

            function getStrategies(cb) {
                testConnection(function(exists) {
                    if (exists) {
                        $.post("/getAllMatchStrategies", {}, function(response) {
                            if (response != "fail") {
                                localStorage.strategies = response;
                                cb(JSON.parse(response));
                            } else {
                                alert("Failed to get match strategies");
                            }
                        });
                    } else {
                        cb(JSON.parse(localStorage.strategies));
                    }
                });
            }
            $("#update-button").on("click", function() {
                var strategy = $("#strategy-box").val();
                var match = qs("match");
                $.post("/setMatchStrategy", {
                    match: match,
                    strategy: strategy
                }, function(response) {
                    if (response == "success") {
                        alert("Success");
                        loadStrategy();
                    } else {
                        alert("Failed to set strategy");
                    }
                });
            });

            $('.report-table td').hover(function() {
                $(this).toggleClass('button-hovered-report')
            });
            $('.report-table td').click(function() {
                currentTeam = $(this).html();
                loadAllMatchesTable(currentTeam);
                $(".report-table td").removeClass("button-selected-report");
                $(this).addClass("button-selected-report");
                $('#form-preview').fadeIn(300);
                $("#form-preview").fadeIn(300);
                $('#report-tabs').fadeIn(300);
                $('#scout-tab').trigger("click");
                smoothScroll('b3');
            });
            $('#view-tab').click(function() {
                $('#view-tab').addClass("active");
                $('#scout-tab').removeClass('active');
                $('#viewMatches-tab').removeClass('active');
                $('#editStrategy-tab').removeClass('active');
                $('#viewMatches-form').hide();
                $("#form-preview").hide();
                $("#editStrategy-form").hide();
                //$('#scout-form').hide();
                $(".view-form").show();
                $('#submit-match-report').hide();
                testConnection(function(exists) {
                    if (exists) {
                        $.post("/getMatchReports", {
                            team: currentTeam,
                            match: currentMatch
                        }, function(response) {
                            var reports = JSON.parse(response);
                            loadDataViewer("#viewContainer", reports);
                        });
                    } else {
                        var allReports = JSON.parse(localStorage.allReports);
                        var relevantReports = [];
                        for (var i = 0; i < allReports.length; i++) {
                            if (allReports[i].team == parseInt(currentTeam) && allReports[i].context == "match" && allReports[i].match == parseInt(currentMatch)) {
                                relevantReports.push(allReports[i]);
                            }
                        }
                        loadDataViewer("#viewContainer", {
                            yourTeam: relevantReports,
                            otherTeams: []
                        });
                    }
                });
            });
            $('#submit-match-report').hide();
            $('#scout-tab').click(function() {
                $('#scout-tab').addClass("active");
                $('#view-tab').removeClass('active');
                $('#viewMatches-tab').removeClass('active');
                $('#editStrategy-tab').removeClass('active');
                //$('#scout-form').show();
                $("#form-preview").show();
                $(".view-form").hide();
                $('#viewMatches-form').hide();
                $('#editStrategy-form').hide();
                $('#submit-match-report').html('Submit');
                $('#submit-match-report').prop('disabled', false);
                $('#submit-match-report').css({
                    "background-color": "orange",
                    "color": "black"
                });
                $('#submit-match-report').addClass('button');
                $('#submit-match-report').removeClass('button-disabled');
                $('#viewContainer').html('');
                $('#submit-match-report').show();
            });
            $('#viewMatches-tab').click(function() {
                loadAllMatchesTable(currentTeam);
                $('#viewContainer').html('');
                $('#viewMatches-tab').addClass("active");
                $('#scout-tab').removeClass('active');
                $('#view-tab').removeClass('active');
                $('#editStrategy-tab').removeClass('active');
                $('#viewMatches-form').show();
                $('#view-form').hide();
                $('#editStrategy-form').hide();
                $("#form-preview").hide();
                $('#submit-match-report').hide();
                //$('#scout-form').hide();

            })
            $('#editStrategy-tab').click(function() {
                $('#viewContainer').html('');
                $('#editStrategy-tab').addClass("active");
                $('#scout-tab').removeClass('active');
                $('#view-tab').removeClass('active');
                $('#viewMatches-tab').removeClass('active');
                $('#editStrategy-form').show();
                $('#view-form').hide();
                $("#form-preview").hide();
                $('#viewMatches-form').hide();
                $('#submit-match-report').hide();
                //$('#scout-form').hide();

            })

            $('#submit-match-report').click(function() {

                // 		$('#submit-match-report').html('Done!');
                // 		$('#submit-match-report').prop('disabled', true);
                // 		$('#submit-match-report').removeClass('button-hovered');
                // 		$('#submit-match-report').removeClass('button');
                // 		$('#submit-match-report').addClass('button-disabled');
                // 		$('#submit-match-report').css({"background-color":"black","color":"orange"});
                // 		setTimeout(function() {
                // 			$('#submit-match-report').html('Submit');
                // 			$('#submit-match-report').prop('disabled', false);
                // 			$('#submit-match-report').css({"background-color":"orange","color":"black"});
                // 			$('#submit-match-report').addClass('button');
                // 			$('#submit-match-report').removeClass('button-disabled');
                // 		}, 1000);

                getScoutFormValues("match");

            });
            $("#form-preview").hide();
            //$('#scout-form').hide();
            $('.view-form').hide();
            $('#report-tabs').hide();
            $('#viewMatches-form').hide();
            $("#editStrategy-form").hide();

        });
    </script>

</body>

</html>
