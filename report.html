<!DOCTYPE html>
<html lang = "en">

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MorScout - Report Match</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Exo+2:100' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link rel="stylesheet" href="css/report_screen.css" type="text/css">
  </head>

  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
    	<div class="container-fluid">
    		<div class="navbar-header">
    		  <a class="navbar-brand" href="index.html">MorScout</a>
    		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#MorScoutNav" id = "toggle-button">
    			<span class="icon-bar"></span>
    			<span class="icon-bar"></span>
    			<span class="icon-bar"></span>
    		  </button>
    		</div>
    		<div class="collapse navbar-collapse" id="MorScoutNav">
    		  <ul class="nav navbar-nav">
    			<li><a href="matches.html"title="List of all matches">All Matches</a></li>
    			<li><a href="teams.html"title="List of all teams">Team List</a></li>
    			<li><a href="settings.html" title="Configure the settings">Settings</a></li>
    		  </ul>
    		  <ul class="nav navbar-nav navbar-right">
    			<li><a href="help.html" title="Need help?">Help</a></li>
    			<li><a href="feedback.html" title="Give team 1515 your feedback!">Feedback</a></li>
          <li><a href="profile.html"  title="User Profile">Profile</a></li>
    			<li id="UserDropdown" class="dropdown">
    				<a id="logoutButton" href="login.html">Log in</a>
    			</li>
    		  </ul>
              <div class='user-search nav navbar-nav'>
                <input type="text" placeholder="Search Users" class="nav-tbox"></input>
                <div class="search-drop">
                  <ul class="search-drop-items">
                  </ul>
                </div>
              </div>
    		</div>
    	</div>
    </nav>

    <div class="report">
    	<div class="container-fluid">
    		<div id="report-title" class="page-title">
    			<h2>Match </h2>
    			<h2 id="report-match-num"></h2>
    			<h2> - </h2>
    			<h2 id="report-match-time"></h2>
    			<h2 id="report-instruction">Choose a team to scout or view</h2>
    		</div>
    		<div class="row">
    			<div class = "col-md-12">
    				<table class="report-table">
    					<tr>
    						<th id="rh">Red Teams</th>
    						<th id="bh">Blue Teams</th>
    					</tr>
    					<tr>
    						<td id="r1"></td>
    						<td id="b1"></td>
    					</tr>
    					<tr>
    						<td id="r2"></td>
    						<td id="b2"></td>
    					</tr>
    					<tr>
    						<td id="r3"></td>
    						<td id="b3"></td>
    					</tr>
    				</table>
    			</div>
    		</div>
    		<div class="row">
    			<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    			<div class="col-md-10 col-sm-12 col-xs-12">
    				<ul id="report-tabs" class="nav nav-tabs">
    				  <li id="scout-tab" class="active"><a href="javascript: void(0);">Scout</a></li>
    				  <li id="view-tab"><a href="javascript: void(0);">View</a></li>
    				  <li id="viewMatches-tab"><a href="javascript: void(0);">All Matches</a></li>
    				</ul>
    			</div>
    			<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    		</div>
    		<div id="form-preview" class="row">
    			<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    			<div class="col-md-5 col-sm-6 col-xs-12">
    	  	    	<div class="scout-div">
    	  	    		<h3 class="scout-div-title">Autonomous</h3>
    	  	    		<div class="radio">
    		  	    		<input class="report-check" type="radio" name="auto" id="nearDrivers"></input>
    		  	    		<label id="report-text" for="nearDrivers" class="report-radio-check">Started near drivers</label><br/>
    						<input class="report-check" type="radio" name="auto" id="radio12"></input>
    						<label id="report-text" for="radio12" class="report-radio-check">Started near landfill</label><br/>
    					</div>

    	  	    		<input class="report-check" type="checkbox" id="robotMoved"></input>
    	  	    		<label id="report-text" for="robotMoved" class="report-radio-check">Robot moves to auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="toteMoved"></input>
    					<label id="report-text" for="toteMoved" class="report-radio-check">Tote moved to auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="containerMoved"></input>
    					<label id="report-text" for="containerMoved" class="report-radio-check">Container set on auto zone?</label><br/>

    					<input class="report-check" type="checkbox" id="toteStacked"></input>
    					<label id="report-text" for="toteStacked" class="report-radio-check">Single stacked tote set?</label><br/>

    	  	    		<p id="report-text">Highest level tote stacked: </p>
    	  	    		<input id="report-box-small" class="highestToteAuto" type="number"></input><br/>

    	  	    		<textarea id="autoComments" class="report-area" placeholder="comments"></textarea>
    	  	    	</div>
    			</div>
    			<div class="col-md-5 col-sm-6 col-xs-12">
    				<div class="scout-div">
    				    <h3 class="scout-div-title">Teleop</h3>

    					<p id="report-text">Gray tote scored</p>
    	  	    		<input type="button" id="grayTotesMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="grayTotes" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="grayTotesPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Container scored</p>
    	  	    		<input type="button" id="containersMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="containers" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="containersPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Litter in container</p>
    	  	    		<input type="button" id="containerLitterMinus" class="button add-minus-button" value="-"></input>
    	  	    		<input class="containerLitter" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="containerLitterPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Litter put in landfill</p>
    	  	    		<input type="button" id="landfillLitterMinus" class="button add-minus-button" value="-"></input
    	  	    		><input class="landfillLitter" id="report-box-small" type="number" value="0"></input>
    	  	    		<input type="button" id="landfillLitterPlus" class="button add-minus-button" value="+"></input><br/>

    	  	    		<p id="report-text">Highest level tote stacked: </p>
    	  	    		<input id="report-box-small" type="number" class="highestToteTeleop"></input><br/>

    	  	    		<input class="report-check" type="checkbox" id="landfillContainer"></input>
    	  	    		<label id="report-text" for="landfillContainer" class="report-radio-check">Gets container from landfill?</label><br/>
    	  	    		<div class="radio">
    		  	    		<input class="report-check" type="radio" id="coopertitionSet" name="coopertition"></input>
    		  	    		<label id="report-text" for="coopertitionSet" class="report-radio-check">Coopertition set</label><br/>
    						<input class="report-check" type="radio" id="coopertitionStack" name="coopertition"></input>
    						<label id="report-text" for="coopertitionStack" class="report-radio-check">Coopertition stack</label><br/>
    					</div>
    					<textarea id="teleopComments" class="report-area" placeholder="comments"></textarea>
    				</div>
    			</div>
    			<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    		</div>
            <div class="submit-match">
                <button id="submit-match-report" class="button">Submit</button>
            </div>
    		<div id="viewContainer"></div>
    		<div id="viewMatches-form" class="row">
    	    	<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    	    	<div class="col-md-10 col-sm-12 col-xs-12">
    	    		<div class="scout-div fixed-col-table" id="view-table">
    	    			<h3 class="scout-div-title view-title fixed-col-table">All Matches for This Team </h3>
    	    			<table class="viewMatchInTeam" id="matchTable">
    	    				<!-- table inserted here -->
    	    			</table>
    	    		</div>
    	    	</div>
    	    	<div class="col-md-1 col-sm-0 col-xs-0">
    			</div>
    	    </div>
    	</div>
    </div>

  <!-- JAVASCRIPT -->

  <script src="js/jquery-2.1.3.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <script src="js/reportTable.js"></script>
  <script src="js/main.js" type="text/javascript"></script>

  <script>
  function smoothScroll(id){
      var aTag = $("#"+id);
      $('html,body').animate({scrollTop: aTag.offset().top}, 300);
  }

  	$(document).ready(function() {
        currentMatch = parseInt(qs("match"));


        $.post("/getScoutForm", {context: "match"}, function(response){
            var scoutFormDPS = JSON.parse(response);
            synthesizeForm(scoutFormDPS);
        });

        $("#report-match-num").html(qs("match"));
        $.post("/getMatchInfo", {match: qs("match")}, function(response){
            if (response != "fail"){
                var match = JSON.parse(response);
                $("#report-match-time").html(standardizeTime(match.time));
                var redAlliance = match.alliances.red.teams;
                var blueAlliance = match.alliances.blue.teams;
                for (var i = 0; i < 3; i++){
                    $("#r" + (i + 1)).html(redAlliance[i].substring(3));
                    $("#b" + (i + 1)).html(blueAlliance[i].substring(3));
                }
            }
            else {
                alert("Unable to retrieve match info");
            }
        });

  		$('.report-table td').hover(function(){
  			$(this).toggleClass('button-hovered-report')
  		});
  		$('.report-table td').click(function(){
            currentTeam = $(this).html();
            $(".report-table td").removeClass("button-selected-report");
            $(this).addClass("button-selected-report");
   			$('#form-preview').fadeIn(300);
            $("#form-preview").fadeIn(300);
  			$('#report-tabs').fadeIn(300);
            $('#scout-tab').trigger("click");
  			smoothScroll('b3');
  		});
  		$('#view-tab').click(function(){
            $('#view-tab').addClass("active");
            $('#scout-tab').removeClass('active');
            $('#viewMatches-tab').removeClass('active');
            $('#viewMatches-form').hide();
            $("#form-preview").hide();
            //$('#scout-form').hide();
            $(".view-form").show();
            $('#submit-match-report').hide();
            $.post("/getMatchReports", {team: currentTeam, match: currentMatch}, function(response){
                var reports = JSON.parse(response);
                var yourTeam = reports.yourTeam;
                var otherTeams = reports.otherTeams;
                $("#viewContainer").empty();
                var div = $(document.createElement('div'));
    			div.addClass("yourReportsView");
    			var h3 = $(document.createElement("h3"));
    			h3.addClass("scout-div-title");
    			h3.html("Your Team");
    			div.append(h3);
                $("#viewContainer").append(div);

                var div = $(document.createElement('div'));
    			div.addClass("otherReportsView");
    			var h3 = $(document.createElement("h3"));
    			h3.addClass("scout-div-title");
    			h3.html("Other Teams");
    			div.append(h3);
                $("#viewContainer").append(div);

                for (var i = 0; i < yourTeam.length; i++){
                    var yourReport = yourTeam[i].data;

                    var viewFormDiv = $(document.createElement('div'));
        			viewFormDiv.addClass("row view_form");

                    var reportIDDiv = $(document.createElement('div'));
        			reportIDDiv.addClass("reportID");
                    reportIDDiv.html("Report #"+(i+1));

                    viewFormDiv.append(reportIDDiv);
                    $(".yourReportsView").append(viewFormDiv);


                    var currentTable;
                    var labelAdded = false;
                    for (var j = 0; j < yourReport.length; j++){
                        var dp = yourReport[j];
                        var isLabel = !dp.value;
                        if (isLabel || j == 0){
                            var colDiv = $(document.createElement('div'));
                            if (labelAdded) {
                                colDiv.addClass("col-md-5 col-sm-6 col-xs-12");
                                currentTable.parent().parent().addClass("col-md-5 col-sm-6 col-xs-12");
                            }
                            labelAdded = true;

                            var newSectionDiv = $(document.createElement('div'));
                            newSectionDiv.addClass("scout-div auto-view");

                            var h3 = $(document.createElement("h3"));
                            if (isLabel) h3.html(dp.name);
                            h3.addClass("scout-div-title view-title");

                            var table = $(document.createElement("table"));
                            table.attr("id", "view-table");
                            table.css("width: auto;");
                            currentTable = table;

                            newSectionDiv.append(h3);
                            newSectionDiv.append(table);
                            colDiv.append(newSectionDiv)
                            viewFormDiv.append(colDiv);
                        }
                        if (!isLabel){//NOT else if
                            var tr = $(document.createElement("tr"));
                            var key = $(document.createElement("td"));
                            key.html(dp.name);
                            var value = $(document.createElement("td"));
                            value.html(dp.value);
                            tr.append(key);
                            tr.append(value);
                            currentTable.append(tr);
                        }
                    }
                }
                for (var i = 0; i < otherTeams.length; i++){
                    var otherReport = otherTeams[i].data;

                    var viewFormDiv = $(document.createElement('div'));
                    viewFormDiv.addClass("row view_form");

                    var reportIDDiv = $(document.createElement('div'));
                    reportIDDiv.addClass("reportID");
                    reportIDDiv.html("Report #"+(i+1));

                    viewFormDiv.append(reportIDDiv);
                    $(".otherReportsView").append(viewFormDiv);


                    var currentTable;
                    var labelAdded = false;
                    for (var j = 0; j < otherReport.length; j++){
                        var dp = otherReport[j];
                        var isLabel = !dp.value;
                        if (isLabel){
                            var colDiv = $(document.createElement('div'));
                            if (labelAdded) {
                                colDiv.addClass("col-md-5 col-sm-6 col-xs-12");
                                currentTable.parent().parent().addClass("col-md-5 col-sm-6 col-xs-12");
                            }
                            labelAdded = true;

                            var newSectionDiv = $(document.createElement('div'));
                            newSectionDiv.addClass("scout-div auto-view");

                            var h3 = $(document.createElement("h3"));
                            if (isLabel) h3.html(dp.name);
                            h3.addClass("scout-div-title view-title");

                            var table = $(document.createElement("table"));
                            table.attr("id", "view-table");
                            currentTable = table;

                            newSectionDiv.append(h3);
                            newSectionDiv.append(table);
                            colDiv.append(newSectionDiv)
                            viewFormDiv.append(colDiv);
                        }
                        else {
                            var tr = $(document.createElement("tr"));
                            var key = $(document.createElement("td"));
                            key.html(dp.name);
                            var value = $(document.createElement("td"));
                            value.html(dp.value);
                            tr.append(key);
                            tr.append(value);
                            currentTable.append(tr);
                        }
                    }

                }

            });
  		});
        $('#submit-match-report').hide();
  		$('#scout-tab').click(function(){
  			$('#scout-tab').addClass("active");
  			$('#view-tab').removeClass('active');
  			$('#viewMatches-tab').removeClass('active');
  			//$('#scout-form').show();
            $("#form-preview").show();
  			$(".view-form").hide();
  			$('#viewMatches-form').hide();
  			$('#submit-match-report').html('Submit');
  			$('#submit-match-report').prop('disabled', false);
  			$('#submit-match-report').css({"background-color":"orange","color":"black"});
  			$('#submit-match-report').addClass('button');
  			$('#submit-match-report').removeClass('button-disabled');
  			$('#viewContainer').html('');
            $('#submit-match-report').show();
  		});
  		$('#viewMatches-tab').click(function(){
  			$('#viewMatches-tab').addClass("active");
  			$('#scout-tab').removeClass('active');
  			$('#view-tab').removeClass('active');
  			$('#viewMatches-form').show();
  			$('#view-form').hide();
            $("#form-preview").hide();
      		//$('#scout-form').hide();

  		})

  		$('#submit-match-report').click(function(){

  		// 		$('#submit-match-report').html('Done!');
  		// 		$('#submit-match-report').prop('disabled', true);
  		// 		$('#submit-match-report').removeClass('button-hovered');
  		// 		$('#submit-match-report').removeClass('button');
  		// 		$('#submit-match-report').addClass('button-disabled');
  		// 		$('#submit-match-report').css({"background-color":"black","color":"orange"});
  		// 		setTimeout(function() {
  		// 			$('#submit-match-report').html('Submit');
  		// 			$('#submit-match-report').prop('disabled', false);
  		// 			$('#submit-match-report').css({"background-color":"orange","color":"black"});
  		// 			$('#submit-match-report').addClass('button');
  		// 			$('#submit-match-report').removeClass('button-disabled');
  		// 		}, 1000);

            getScoutFormValues();

  		});
        $("#form-preview").hide();
  		//$('#scout-form').hide();
  		$('.view-form').hide();
  		$('#report-tabs').hide();
  		$('#viewMatches-form').hide();

  	});
  </script>

  </body>
</html>
